
<html>

<head>
	<title>Interactive Computer Music</title>
</head>

<body>

	<form>
		Note: <input type="text" id="note"></input>
		<input type="submit" value="Submit" onclick="test()">
	</form>
	

	<script language="javascript">

		if ('webkitAudioContext' in window) {
    		var myAudioContext = new webkitAudioContext();
		}
		else {
			alert("Sorry - this app requires an updated version of Chrome or Safari!");
		}

		/*
		 * Inputs: note   --- a string of the note to play, such as 'A'
		 * 		   length --- the number of seconds to play the note
		 *
		 * Plays a specified note for a certain length of time.
		 */
		function playNote(note, length) {
			var source = myAudioContext.createOscillator();
			source.type = 1; 
			source.frequency.value = note;
			source.connect(myAudioContext.destination);
			source.start(myAudioContext.currentTime);
			source.stop(myAudioContext.currentTime + length);
		}

		/*
		 * Inputs: duration --- the interval at which to call the function
		 * 		   fn       --- the function to call
		 *
		 * Replaces setTimeout() with a more accurate version.
		 */
		function interval(duration, fn) {
			this.baseline = undefined
			this.run = function() {
			    if (this.baseline === undefined) {
			    	this.baseline = new Date().getTime();
			    }
			    fn();
			    var end = new Date().getTime();
			    this.baseline += duration;
			    var nextTick = duration - (end - this.baseline);
			    if (nextTick < 0) {
			      nextTick = 0;
			    }
			    (function(i) {
			        i.timer = setTimeout(function() {
			        	i.run(end);
			      	}, nextTick)
			    }) (this)
		  	}
			this.stop = function() {
		   		clearTimeout(this.timer);
		 	}
		}

		var timer = new interval(1000, function() {
	    	playNote((Math.random()*620)+220, 1);
	    });
		
	    var timer2 = new interval(1000, function() {
	    	playNote((Math.random()*620)+220, 1);
	    });

	    timer.run();
	    timer2.run();

	</script>

</body>

</html>