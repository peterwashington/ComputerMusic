
<html>

<head>
	<title>Interactive Computer Music</title>

	<script language="javascript">

		/*
		 * Inputs: note   --- a string of the note to play, such as 'A'
		 * 		   length --- the number of seconds to play the note
		 *
		 * Plays a specified note for a certain length of time.
		 */
		function playNote(note, length) {
			var source = myAudioContext.createOscillator();
			source.type = 1; 
			source.frequency.value = note;
			source.connect(myAudioContext.destination);
			source.start(myAudioContext.currentTime);
			source.stop(myAudioContext.currentTime + length);
		}

		/*
		 * Inputs: duration --- the interval at which to call the function
		 * 		   fn       --- the function to call
		 *
		 * Replaces setTimeout() with a more accurate version.
		 */
		function interval(duration, fn) {
			this.baseline = undefined
			this.run = function() {
			    if (this.baseline === undefined) {
			    	this.baseline = new Date().getTime();
			    }
			    fn();
			    var end = new Date().getTime();
			    this.baseline += duration;
			    var nextTick = duration - (end - this.baseline);
			    if (nextTick < 0) {
			      nextTick = 0;
			    }
			    (function(i) {
			        i.timer = setTimeout(function() {
			        	i.run(end);
			      	}, nextTick)
			    }) (this)
		  	}
			this.stop = function() {
		   		clearTimeout(this.timer);
		 	}
		}

		/*
		 * Inputs: note --- the string representation of a note
		 *
		 * Returns the frequency of the note.
		 */
		 function noteToFrequency(note) {
		 	switch (note) {
		 		case "A":
		 			return 440.00;
		 		case "A#":
		 			return 466.16;
		 		case "Bb":
		 			return 466.16;
		 		case "B":
		 			return 493.88;
		 		case "Cb":
		 			return 493.88;
		 		case "C":
		 			return 523.25;
		 		case "C#":
		 			return 554.37;
		 		case "Db":
		 			return 554.37;
		 		case "D":
		 			return 587.33;
		 		case "D#":
		 			return 622.25;
		 		case "Eb":
		 			return 622.25;
		 		case "E":
		 			return 659.26;
		 		case "Fb":
		 			return 659.26;
		 		case "F":
		 			return 698.46;
		 		case "F#":
		 			return 739.99;
		 		case "Gb":
		 			return 739.99;
		 		case "G":
		 			return 783.99;
		 		case "G#":
		 			return 830.61;
		 		case "Ab":
		 			return 830.61;
		 	}
		 }

		 function swag() {
		 	notes.pop();
		 }

	</script>

	<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
</head>



<body>

	<script src="http://code.jquery.com/jquery.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>

    <div class="hero-unit">


		<h1>Interactive Computer Music</h1>

		<button class="btn btn-large btn-primary" type="button" onclick="swag()">Remove Note</button>

		<br><br><br><br><br><br><br><br><br><br>

	</div>

	<script langugae="javascript" >

		if ('webkitAudioContext' in window) {
    		var myAudioContext = new webkitAudioContext();
		}
		else {
			alert("Sorry - this app requires an updated version of Chrome or Safari!");
		}

		var notes = ["A", "B", "C#", "D", "E", "F#", "G#"];

		var timer = new interval(1000, function() {
	    	playNote(noteToFrequency(notes[Math.floor(Math.random() * notes.length)]), 1);
	    });
		
	    var timer2 = new interval(1000, function() {
	    	playNote(noteToFrequency("A"), 1);
	    });

	    timer.run();
	    timer2.run();

	</script>

</body>

</html>